{"id":"esynyc-lessonsearch-v2-1am","title":"Implement virtual scrolling in CulturalHeritageFilter","description":"GH #354 - VirtualizedCulturalHeritageFilter.tsx has TODO at line 217. Use @tanstack/react-virtual, maintain keyboard navigation.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-18T12:58:46.058608-05:00","updated_at":"2025-12-18T12:58:46.058608-05:00"}
{"id":"esynyc-lessonsearch-v2-2ri","title":"Implement CSV export","description":"GH #353 - SearchPage.tsx line 64 has TODO. Export search results to CSV with all metadata fields, handle escaping.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T12:58:46.362487-05:00","updated_at":"2025-12-18T18:47:51.346373-05:00","closed_at":"2025-12-18T18:47:51.346373-05:00","close_reason":"CSV export feature removed from project scope. All placeholder code and documentation references have been removed."}
{"id":"esynyc-lessonsearch-v2-3ua","title":"[P1] send-email skips auth for 4 email types","description":"send-email/index.ts:78-84 bypasses auth for password-reset, role-changed, account-deactivated, account-reactivated types. Allows unauthenticated callers to send emails to arbitrary addresses from trusted sender. Fix: require HMAC signature or service-role-only access for server-triggered types.","status":"open","priority":1,"issue_type":"bug","created_at":"2026-02-06T17:32:57.210328-05:00","updated_at":"2026-02-06T17:32:57.210328-05:00"}
{"id":"esynyc-lessonsearch-v2-481","title":"Standardize Supabase error handling","description":"GH #347 - Implement consistent try-catch-finally pattern. Use parseDbError utility consistently across components.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:58:56.016077-05:00","updated_at":"2025-12-18T18:58:15.284046-05:00","closed_at":"2025-12-18T18:58:15.284046-05:00","close_reason":"PR #389 standardizes Supabase error handling with parseDbError utility"}
{"id":"esynyc-lessonsearch-v2-79m","title":"Add SearchPage integration tests","description":"GH #349 - Main user flow lacks comprehensive tests. Cover search+filter flow, pagination, URL param sync, empty results, error states.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T12:58:55.715942-05:00","updated_at":"2025-12-18T18:17:11.003662-05:00","closed_at":"2025-12-18T18:17:11.003662-05:00","close_reason":"Implemented 22 SearchPage integration tests covering LessonModal, FilterPills, Sort, ResultsHeader, Empty State, and Screen Reader announcements"}
{"id":"esynyc-lessonsearch-v2-7mx","title":"[P2] Invitation acceptance UPDATE fails due to admin-only RLS","description":"AcceptInvitation.tsx:169 tries to update user_invitations.accepted_at, but only UPDATE policy requires is_admin(). New users accepting invitations can't update this. Creates partial state. Fix: move acceptance to server-side edge function using service role, or add an RLS policy for token-based acceptance.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-02-06T17:33:08.496944-05:00","updated_at":"2026-02-06T17:33:08.496944-05:00"}
{"id":"esynyc-lessonsearch-v2-7ss","title":"Fix lessonFormat data type inconsistency","description":"GH #217 - Mismatch: index.ts has both string[] and string types. Database uses string. Standardize and update all code.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-18T12:58:56.618685-05:00","updated_at":"2025-12-18T14:38:53.388161-05:00","closed_at":"2025-12-18T14:38:53.388161-05:00","close_reason":"Fixed in PR #384 - changed LessonMetadata.lessonFormat from string[] to string"}
{"id":"esynyc-lessonsearch-v2-b1h","title":"Add URL persistence for search and filter state","description":"GH #24 - Sync search query and filters to URL parameters so users can share/bookmark searches.","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2025-12-18T19:08:49.17346-05:00","updated_at":"2025-12-18T19:21:18.600769-05:00"}
{"id":"esynyc-lessonsearch-v2-ctk","title":"[P0] user_profiles INSERT allows role escalation","description":"INSERT policy on user_profiles (baseline:3169) only checks auth.uid()=id. Any authenticated user can self-assign admin role. Fix: add role=teacher constraint to INSERT WITH CHECK.","status":"open","priority":0,"issue_type":"bug","created_at":"2026-02-06T17:32:47.617616-05:00","updated_at":"2026-02-06T17:32:47.617616-05:00"}
{"id":"esynyc-lessonsearch-v2-de0","title":"Test beads installation","description":"Verify beads is working correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T12:53:56.267023-05:00","updated_at":"2025-12-18T12:54:12.207836-05:00","closed_at":"2025-12-18T12:54:12.207836-05:00","close_reason":"Test complete - beads is working"}
{"id":"esynyc-lessonsearch-v2-e42","title":"Optimize ReviewDetail data loading with parallel queries","description":"GH #147 - Performance enhancement to load ReviewDetail data in parallel instead of sequentially.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T19:08:47.384413-05:00","updated_at":"2025-12-18T19:08:47.384413-05:00"}
{"id":"esynyc-lessonsearch-v2-e9k","title":"Create type helper utilities for Json field casting","description":"GH #207 - Type-safe utilities for casting Supabase Json fields to proper TypeScript types.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T19:08:48.798068-05:00","updated_at":"2025-12-18T19:08:48.798068-05:00"}
{"id":"esynyc-lessonsearch-v2-ehw","title":"Fix: Header statistics not visible on mobile","description":"GH #15 - Header statistics are not visible on mobile devices. Bug affecting users.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T19:08:01.131973-05:00","updated_at":"2025-12-18T19:19:58.556774-05:00","closed_at":"2025-12-18T19:19:58.556774-05:00","close_reason":"Fixed in PR #390 - mobile stats now visible under header title"}
{"id":"esynyc-lessonsearch-v2-ekc","title":"Improve error handling and user feedback in duplicate resolution","description":"GH #156 - Better error messages and user feedback when resolving duplicates.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T19:08:48.080898-05:00","updated_at":"2025-12-18T19:08:48.080898-05:00"}
{"id":"esynyc-lessonsearch-v2-f8b","title":"[P3] Remove /verify-setup debug route from production","description":"App.tsx:193 exposes /verify-setup without auth guard. Page includes admin setup tooling. Fix: remove route or gate behind import.meta.env.MODE === 'development'.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-06T17:33:13.629247-05:00","updated_at":"2026-02-06T17:33:13.629247-05:00"}
{"id":"esynyc-lessonsearch-v2-goa","title":"[P0] user_invitations SELECT USING(true) exposes all invitation data","description":"'Public can view by token' policy (baseline:3079) uses USING(true), making ALL invitations readable by anyone including tokens. Fix: DROP this policy; the stricter 'Public can view valid invitation by token' (baseline:3095) already exists.","status":"open","priority":0,"issue_type":"bug","created_at":"2026-02-06T17:32:52.461711-05:00","updated_at":"2026-02-06T17:32:52.461711-05:00"}
{"id":"esynyc-lessonsearch-v2-i1o","title":"[P0] Password reset open redirect via unvalidated Origin","description":"password-reset/index.ts:89 uses raw Origin header in redirectTo without validating against ALLOWED_ORIGINS. Attacker crafts Origin header to redirect reset link to malicious domain. Fix: validate origin against ALLOWED_ORIGINS before using in redirectTo.","status":"open","priority":0,"issue_type":"bug","created_at":"2026-02-06T17:32:54.358965-05:00","updated_at":"2026-02-06T17:32:54.358965-05:00"}
{"id":"esynyc-lessonsearch-v2-jyr","title":"Search fails with special characters like \u0026 in query","description":"When searching for queries containing special characters like '\u0026' (e.g., 'mac \u0026 cheese'), the search fails with:\n\n```\nError loading lessons: syntax error in tsquery: \"\u0026 | cheese | mac\"\n```\n\n**Root cause**: In `expand_search_with_synonyms()` function, the query is split by spaces but tsquery operators like `\u0026`, `|`, `\\!`, `:` aren't stripped. So 'mac \u0026 cheese' becomes `mac | \u0026 | cheese` which is invalid tsquery syntax.\n\n**Location**: `supabase/migrations/20251001_production_baseline_snapshot.sql` line 177\n\n**Fix**: Sanitize special characters before processing:\n```sql\n-- Before splitting, remove tsquery operators\nquery_text := regexp_replace(query_text, '[\u0026|\\!:*()]', ' ', 'g');\nwords := string_to_array(lower(trim(query_text)), ' ');\n```\n\n**Discovered during**: Manual testing of URL persistence feature (PR #401)","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-22T18:10:24.326803-05:00","updated_at":"2025-12-22T18:10:24.326803-05:00"}
{"id":"esynyc-lessonsearch-v2-njq","title":"Add database indexes for filter query performance","description":"GH #146 - Add indexes to improve filter query performance on lessons table.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T19:08:47.725614-05:00","updated_at":"2025-12-18T19:08:47.725614-05:00"}
{"id":"esynyc-lessonsearch-v2-nps","title":"[P2] supabase.sql usage crashes user delete/bulk-delete","description":"user-management/index.ts lines 612,695 use supabase.sql which doesn't exist in Supabase JS client. Delete and bulk-delete endpoints throw TypeError at runtime. Fix: replace with string concatenation or create an RPC function.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-02-06T17:33:05.313942-05:00","updated_at":"2026-02-06T17:33:05.313942-05:00"}
{"id":"esynyc-lessonsearch-v2-nwt","title":"Improve accessibility: ARIA labels and focus management","description":"GH #39 - Add ARIA labels and improve focus management for screen reader users. High-priority accessibility enhancement.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T19:08:01.477928-05:00","updated_at":"2025-12-18T19:08:01.477928-05:00"}
{"id":"esynyc-lessonsearch-v2-ox9","title":"[P1] Edge functions use CORS:* with internal service role key","description":"import-lessons, generate-embeddings, extract-google-doc, detect-duplicates, search-lessons, smart-search, process-submission all use CORS:*. Functions use service role key internally, bypassing RLS. Anyone with the public anon key can call these. Fix: implement origin validation matching send-email/user-management pattern.","status":"open","priority":1,"issue_type":"bug","created_at":"2026-02-06T17:32:59.853128-05:00","updated_at":"2026-02-06T17:32:59.853128-05:00"}
{"id":"esynyc-lessonsearch-v2-rbz","title":"Add hook tests","description":"GH #350 - 5 hooks lack tests: useLessonSearch, useEnhancedAuth, useLessonSuggestions, useLessonStats, useDebounce. Test return values, side effects, error cases.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:58:47.039295-05:00","updated_at":"2025-12-18T16:13:03.917299-05:00","closed_at":"2025-12-18T16:13:03.917299-05:00","close_reason":"Added 63 unit tests for useDebounce, useLessonStats, and useEnhancedAuth hooks. Note: useLessonSearch and useLessonSuggestions already have integration tests."}
{"id":"esynyc-lessonsearch-v2-trp","title":"Expand RLS policy tests","description":"GH #352 - Current tests only cover a few tables. Need coverage for all 15+ tables with anonymous, authenticated, and role-based access patterns.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T12:58:46.718288-05:00","updated_at":"2025-12-18T19:08:07.873908-05:00"}
{"id":"esynyc-lessonsearch-v2-tyc","title":"[P3] Error messages leak stack traces in edge functions","description":"send-email/index.ts:228, user-management/index.ts:771, process-submission/index.ts expose error.toString() and error.message in HTTP responses. Fix: return generic error messages, log details server-side only.","status":"open","priority":3,"issue_type":"bug","created_at":"2026-02-06T17:33:15.915099-05:00","updated_at":"2026-02-06T17:33:15.915099-05:00"}
{"id":"esynyc-lessonsearch-v2-uia","title":"Add runtime validation for critical database fields","description":"GH #208 - Add validation for critical fields to catch data integrity issues early.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T19:08:48.446815-05:00","updated_at":"2025-12-18T19:08:48.446815-05:00"}
{"id":"esynyc-lessonsearch-v2-wuo","title":"Add data-testid attributes for E2E reliability","description":"GH #329 - Add data-testid to lesson cards, filter buttons, search results. Update E2E tests to use stable selectors.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T12:58:56.313498-05:00","updated_at":"2025-12-18T19:08:07.526167-05:00"}
{"id":"esynyc-lessonsearch-v2-zt1","title":"[P2] super_admin role mismatch between app types and DB constraint","description":"TypeScript defines UserRole.SUPER_ADMIN but DB constraint only allows teacher/reviewer/admin. Multiple RLS policies and migration functions reference super_admin but it can never be set. Fix: either add super_admin to DB constraint or remove from app types and policies.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-02-06T17:33:11.230427-05:00","updated_at":"2026-02-06T17:33:11.230427-05:00"}
